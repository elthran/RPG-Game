{% extends "layout.html" %}
{% block block1 %}

<script type="text/javascript">
function toggleReplyText(button) {
    var id = button.getAttribute("id");
    var x = document.getElementById('replyText-' + id);
    if (x.style.display === 'block') {
        x.style.display = 'none';
    } 
	else {
        x.style.display = 'block';
    }
}


// Validating Empty Field
function check_empty() {
if (document.getElementById('name').value == "" || document.getElementById('email').value == "" || document.getElementById('msg').value == "") {
alert("Fill All Fields !");
} else {
document.getElementById('form').submit();
alert("Form Submitted Successfully...");
}
}

//Function To Display Popup
function divShow(button, messageContent) {
    document.getElementById('inboxPopupOuter').style.display = "block";
    document.getElementById('newTextNeeded').innerHTML = messageContent;
}

//Function to Hide Popup
function div_hide(){
document.getElementById('inboxPopupOuter').style.display = "none";
}
</script>

<div class="inboxTopbar">
    <ul>
        {% if outbox %}
        <li><a href="/inbox/inbox">Inbox</a></li>
        <li><a class="topbarActive" href="/inbox/outbox">Outbox</a></li>
        {% else %}
        <li><a class="topbarActive" href="/inbox/inbox">Inbox</a></li>
        <li><a href="/inbox/outbox">Outbox</a></li>
        {% endif %}
    </ul>
</div>
<div style="clear: both;"></div>
{% if outbox %} <!-- OUTBOX CODE -->
    <ul>
        {% for message in hero.user.inbox.sent_messages %}
        <li>
            <h3>To: <a href=/display_users/see_user/{{ message.receiver.user.username }}>{{ message.receiver.user.username }}</a>
            </h3>{{ message.timestamp }}
            <p>{{ message.content }}</p>
            <button onclick="toggleReplyText(this)" id="out-{{ message.receiver.user.id }}">Message</button>
            <div id="replyText-out-{{ message.receiver.user.id }}" style="display: none">
                <form method="post" action="" autocomplete="off">
                    <input type="text" name="message" value="">
                    <input type="submit" name="receiver" value="{{ message.receiver.user.username }}">
                </form>
            </div>
        </li>
        {% else %}
        Outbox is empty
        {% endfor %}
    </ul>
{% else %} <!-- INBOX CODE -->


<div id="inboxPopupOuter">
<!-- Popup Div Starts Here -->
<div id="inboxPopupInner">
<!-- Reply Popup Box Starts Here -->
<form action="#" id="form" method="post" name="form">
<img id="closeReplyBox" src="/static/images/closing_x.jpg" onclick ="div_hide()">
<h2>Reply</h2>
    <span id="newTextNeeded"></span>
<hr>
<input id="name" name="name" placeholder="Title" type="text">
<input id="email" name="email" placeholder="Message" type="text">
<a href="javascript:%20check_empty()" id="submit">Send</a>
</form>
</div>
<!-- Reply Popup Box Ends Here -->
</div>



{SELECT ALL} {DELETE}
    <table id="inboxTable">
        <tr>
            <th></th>
            <th>From</th>
            <th>Message</th>
            <th>Timestamp</th>
            <th>ID</th>
        </tr>
    {% for message in hero.user.inbox.received_messages %}
        <tr>
            <td><img src="/static/images/empty_box.jpg" style="width:25px;height:25px;"></td>
            <td><a href=/display_users/see_user/{{ message.sender.user.username }}>{{ message.sender.user.username }}</a></td>
            <td>
                <!-- Button to Display Popup Button -->
                <button id="popup" data="{{ message.id }}"
                        data-py-function="get_message_content_by_id"
                        data-js-callback="divShow">{{ message.content[0:10]
                    }}</button>
            </td>
            <td>{{ message.timestamp[0:10] }}</td>
            <td>{{ message.id }}</td>
        </tr>
    <!-- OLD CODE
    <li>
        {% if message.unread %}
        <h3 style="color:red;">
        {% else %}
        <h3 style="color:yellow;">
        {% endif %}
        From: <a href=/display_users/see_user/{{ message.sender.user.username }}>{{ message.sender.user.username }}</a>
        </h3>{{ message.timestamp }}
        <p>{{ message.content }}</p>
        <button onclick="toggleReplyText(this)" id="in-{{ message.sender.user.id }}">Reply</button>
        <div id="replyText-in-{{ message.sender.user.id }}" style="display: none">
            <form method="post" action="" autocomplete="off">
                <input type="text" name="message" value="">
                <input type="submit" name="receiver" value="{{ message.sender.user.username }}">
            </form>
        </div>
    </li>
    -->
    {% endfor %}
    </table>
{% endif %}
{% endblock %}
