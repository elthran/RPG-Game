{% extends "profile_template.html" %}
{% block block2 %}

<!-- Basic Skill Page -->

<script type="text/javascript">
function changeAttributeBox(new_name, new_content) {
    "use strict";
    document.getElementById("attributeText").innerHTML = new_content;
    document.getElementById("attributeName").innerHTML = new_name;
}

var remainingPoints = {{ myHero.attribute_points }};

// Mixed Jinja2 with JS ... kind of hard to read.
// If you want the pure code go to the web page and view page source.
// This is only possible because of the clean and symetric code written before.
{% for attribute, attributeValue in myHero.attributes.items() %}
var {{ attribute }}Value = {{ attributeValue.level }};
function {{ attribute }}Modifier(modifier) {
    "use strict";
    {{ attribute }}Value = isNaN({{ attribute }}Value)
        ? 0
        : {{ attribute }}Value;
    if (modifier === "increase" && remainingPoints > 0) {
        {{ attribute }}Value += 1;
        document.getElementById("new{{ attribute.capitalize() }}Value").style.color = "green";
        remainingPoints -= 1;
    } else if (modifier === "decrease" && {{ attribute }}Value > {{ attributeValue.level }}) {
        {{ attribute }}Value -= 1;
        remainingPoints += 1;
        if ({{ attribute }}Value === {{ attributeValue.level }}) {
            document.getElementById("new{{ attribute.capitalize() }}Value").style.color = "white";
        }
    }
    // This updates the value sent to python
    document.getElementById("{{ attribute }}Value").value = {{ attribute }}Value;
    // This updates the value that the user sees in HTML
    document.getElementById("new{{ attribute.capitalize() }}Value").value = {{ attribute }}Value;
    document.getElementById("pointsRemaining").value = remainingPoints;
}
{% endfor %}

</script>

<form method="post">
    <div class="profilePage">
        Points Remaining:
        <output type="text" name="total" id="pointsRemaining" value="{{ myHero.attribute_points }}"/>
        {{ myHero.attribute_points }}</output>
    </div>
    {% if myHero.attribute_points %}
    <input class="btn btn-default submitButton" type="submit" value="Save" id="level_button">
    {% endif %}
    <div style="clear: both;"></div>
    <div class="profilePage">
        <div class="profilePageAttributes">
            <ul>
                {% for attribute in attribute_information %}
                <li>
                    <button type="button" class="profileText"
                            onclick="changeAttributeBox('{{ attribute[0] }}', '{{ attribute[1] | safe }}')">{{
                        attribute[0] }}:
                    </button>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="profilePageValues">
            <ul>
                {% for attribute, value in myHero.attributes.items() %}
                <li>
                    <input type="button" onclick="{{ attribute }}Modifier('decrease')"
                           class="abilityButton abilityButtonMinus">
                    <input id="{{ attribute }}Value" type="hidden" name="{{ attribute }}Input"
                           value="{{ value.level }}">
                    <output name="{{ attribute }}Output" id="new{{ attribute.capitalize() }}Value">{{ value.level }}
                    </output>
                    <input type="button" onclick="{{ attribute }}Modifier('increase')"
                           class="abilityButton abilityButtonPlus">
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="profilePage profilePageInfo">
        <h1>
            <div id="attributeName">Attribute</div>
        </h1>
        <p>
        <div id="attributeText">Description.</div>
        </p>
    </div>
</form>

{% endblock %}
